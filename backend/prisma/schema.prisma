generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum NotificationTypes {
  VOTE_NOTIFICATION
  REPORT_NOTIFICATION
  COMMENT_NOTIFICATION
  MESSAGE_NOTIFICATION
  FEEDBACK_NOTIFICATION
}

enum FeedbackStatuses {
  PENDING
  IN_PROGRESS
  RESOLVED
  REJECTED
}

enum ReportStatuses {
  RESOLVED
  PENDING
  REJECTED
}

enum UserRoles {
  DEPARTMENT_STAFF
  STUDENT
  ADMIN
}

model Users {
  userId        Int       @id @default(autoincrement())
  fullName      String
  password      String
  email         String    @unique
  role          UserRoles
  departmentId  Int
  createdAt     DateTime

  department      Departments                   @relation(fields: [departmentId], references: [departmentId])
  feedbacks       Feedbacks[]
  votes           Votes[]
  comments        Comments[]
  commentReports  CommentReports[]
  forwardingLogs  ForwardingLogs[]
  conversations   ClarificationConversations[]
  messages        Messages[]
  announcements   Announcements[]
  notifications   Notifications[]
}

model Departments {
  departmentId   Int    @id @default(autoincrement())
  departmentName String

  users                                                           Users[]
  feedbacks                                                       Feedbacks[]
  forwardingLogsFromDepartmentId ForwardingLogs[] @relation("FromDepartment")
  forwardingLogsToDepartmentId   ForwardingLogs[] @relation("ToDepartment")
}

model Categories {
  categoryId   Int    @id @default(autoincrement())
  categoryName String

  feedbacks Feedbacks[]
}

model Feedbacks {
  feedbackId     Int             @id @default(autoincrement())
  subject        String
  description    String
  currentStatus  FeedbackStatuses
  isPrivate      Boolean
  userId         Int
  departmentId   Int
  categoryId     Int
  createdAt      DateTime

  user             Users                          @relation(fields: [userId], references: [userId])
  department       Departments                    @relation(fields: [departmentId], references: [departmentId])
  category         Categories                     @relation(fields: [categoryId], references: [categoryId])
  statusHistory    FeedbackStatusHistory[]
  forwardingLogs   ForwardingLogs[]
  forumPost        ForumPosts?
  conversations    ClarificationConversations[]
  fileAttachments  FileAttachmentForFeedback[]
}

model FeedbackStatusHistory {
  feedbackStatusId Int             @id @default(autoincrement())
  feedbackId       Int
  status           FeedbackStatuses
  message          String?
  createdAt        DateTime

  feedback Feedbacks @relation(fields: [feedbackId], references: [feedbackId])
}

model ForwardingLogs {
  forwardingLogId   Int      @id @default(autoincrement())
  feedbackId        Int
  fromDepartmentId  Int
  toDepartmentId    Int
  userId            Int
  message           String?
  createdAt         DateTime

  feedback        Feedbacks   @relation(fields: [feedbackId], references: [feedbackId])
  fromDepartment  Departments @relation("FromDepartment", fields: [fromDepartmentId], references: [departmentId])
  toDepartment    Departments @relation("ToDepartment", fields: [toDepartmentId], references: [departmentId])
  user            Users       @relation(fields: [userId], references: [userId])
}

model ForumPosts {
  postId     Int      @id @default(autoincrement())
  feedbackId Int      @unique
  createdAt  DateTime

  feedback Feedbacks  @relation(fields: [feedbackId], references: [feedbackId])
  votes    Votes[]
  comments Comments[]
}

model Votes {
  userId    Int
  postId    Int
  createdAt DateTime

  user Users       @relation(fields: [userId], references: [userId])
  post ForumPosts @relation(fields: [postId], references: [postId])

  @@id([userId, postId])
}

model Comments {
  commentId Int      @id @default(autoincrement())
  postId    Int
  userId    Int
  content   String
  createdAt DateTime

  post    ForumPosts       @relation(fields: [postId], references: [postId])
  user    Users            @relation(fields: [userId], references: [userId])
  reports CommentReports[]
}

model CommentReports {
  commentReportId Int           @id @default(autoincrement())
  commentId       Int
  userId          Int
  reason          String?
  status          ReportStatuses
  adminResponse   String?
  createdAt       DateTime

  comment Comments @relation(fields: [commentId], references: [commentId])
  user    Users    @relation(fields: [userId], references: [userId])
}

model ClarificationConversations {
  conversationId Int      @id @default(autoincrement())
  feedbackId     Int
  isClosed       Boolean
  userId         Int
  createdAt      DateTime

  feedback Feedbacks  @relation(fields: [feedbackId], references: [feedbackId])
  user     Users      @relation(fields: [userId], references: [userId])
  messages Messages[]
}

model Messages {
  messageId      Int      @id @default(autoincrement())
  conversationId Int
  userId         Int
  content        String
  createdAt      DateTime

  conversation ClarificationConversations @relation(fields: [conversationId], references: [conversationId])
  user         Users                      @relation(fields: [userId], references: [userId])
}

model FileAttachmentForFeedback {
  id         Int    @id @default(autoincrement())
  feedbackId Int
  fileName   String
  fileUrl    String

  feedback Feedbacks @relation(fields: [feedbackId], references: [feedbackId])
}

model FileAttachmentForAnnouncement {
  id             Int    @id @default(autoincrement())
  announcementId Int
  fileName       String
  fileUrl        String

  announcement Announcements @relation(fields: [announcementId], references: [id])
}

model Announcements {
  id         Int      @id @default(autoincrement())
  title      String
  content    String
  createdAt  DateTime
  userId     Int

  user  Users                             @relation(fields: [userId], references: [userId])
  files FileAttachmentForAnnouncement[]
}

model Notifications {
  notificationId   Int               @id @default(autoincrement())
  userId           Int
  content          String
  notificationType NotificationTypes
  isRead           Boolean
  createdAt        DateTime

  user Users @relation(fields: [userId], references: [userId])
}